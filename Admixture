#Move to the directory with complete filtered vcfs 
cd EthiopianBirdsProject/ConcatVcf

# Make a chromosome-map consisting of 2 columns, each containing a list of all chromosomes. An example can be seen in the main project folder.
# (Taken from JD Manthey)

grep -v "#" batis.vcf | cut -f 1 | uniq | awk '{print $0"\t"$0}' > chrom_map.txt

# Submit the plink_convert.sh script to convert the vcfs to plink format

# Intiate interactive session. 
# Since admixture uses the outputted .ped files, I used a list of these files to run an admixture for loop to avoid running admixture 60 times individuals.

ls | grep "ped" | grep "kbp2" > AdmixtureList.txt

# Run Admixture using a for loop on the input AdmixtureList file. 

 for i in $(cat AdmixtureList.txt); do for K in 1 2 3 4 5; do admixture --cv ${i} $K | tee log_${i}_$K.out; done; done
 
 # This will output 60 admixture runs, 5 for each of the 12 ped files.
 # To compare between results between the two filtering schemes, and between species, I placed all of the CV outputs used to indicate the likely number 
 # of populations into one file with the appropriate header. 
 
 # I started by generating a list of the unique log output files then ran this in a for loop that put all the cv outputs for each k for each species
 # into one file with the appropriate species header. An example is shown in EthiopianBirdsProject directory as CV.txt. 
 
 ls | grep "ped_" | sed 's/_/\t/g' | cut -f 1,2,3 | sed 's/\t/_/g' | uniq > logList.txt
 
 for i in $(cat logList.txt); do more logList.txt | grep ${i} >> CV.txt; grep -h CV ${i}_*.out >> CV.txt; done
 
 
